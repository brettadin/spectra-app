# AI Log — 2025-10-24

## Tasking — Overlay controller extraction
- Decouple overlay/session logic from Streamlit so alternative UIs can reuse the same workspace behaviour.

## Actions & Decisions
- Implemented `WorkspaceController` with overlay, viewport, differential, and similarity helpers while providing a thin Streamlit adapter. 【F:app/ui/controller.py†L1-L602】
- Refactored `app/ui/main.py` to delegate overlay rendering, differential exports, and similarity setup to the controller. 【F:app/ui/main.py†L1621-L1900】
- Added a CLI harness that exercises the controller without Streamlit and created controller-focused tests. 【F:app/controller_demo.py†L1-L74】【F:tests/ui/test_controller_module.py†L1-L66】

## Verification
- `pytest tests/ui/test_controller_module.py` 【90219d†L1-L6】
- `python -m app.controller_demo` 【1cc0cf†L1-L10】

## Docs Consulted
- Internal controller design history (`docs/atlas/brains.md`). 【F:docs/atlas/brains.md†L1-L4】
## Tasking — SpecViz batch ingestion helpers
- Deliver SpecViz-compatible batch ingestion pathways with scripted helper parity and provider diagnostics.

## Actions & Decisions
- Added directory-aware batch ingest wrappers that report per-file provenance and expanded regression coverage for batch success/failure accounting. 【F:app/utils/local_ingest.py†L55-L167】【F:app/utils/local_ingest.py†L866-L1077】【F:tests/server/test_local_ingest.py†L787-L818】
- Published `SpecvizCompatHelper` plus helper tests to mirror jdaviz helper signatures for scripted ingest workflows. 【F:app/helpers/specviz_compat.py†L1-L156】【F:tests/utils/test_specviz_compat.py†L1-L64】
- Extended archive providers with program concatenation, catalog filters, and diagnostics to surface richer failure context; updated provider tests for concatenated pulls. 【F:app/providers/mast.py†L61-L405】【F:app/providers/eso.py†L72-L233】【F:app/providers/sdss.py†L71-L252】【F:app/providers/doi.py†L64-L218】【F:tests/providers/test_mast_provider.py†L122-L157】

## Verification
- `pytest tests/server/test_local_ingest.py tests/providers/test_mast_provider.py tests/utils/test_specviz_compat.py` 【6f7cf6†L1-L29】

## Docs Consulted
- SpecViz-inspired improvement backlog for helper parity requirements. 【F:docs/research/specviz_improvement_backlog.md†L1-L74】
- MAST Data Format guidelines (mirrored) for provenance context expectations. 【F:docs/mirrored/stsci_archive/data_format.html.meta.json†L1-L7】
## Tasking — SpecViz parity matrix publishing
- Publish a SpecViz-to-Spectra feature matrix and ensure user guides credit the jdaviz authors for upstream documentation.

## Actions & Decisions
- Added a SpecViz parity matrix with ingestion, viewer, and plugin deltas plus explicit attribution for the jdaviz maintainers. 【F:docs/research/specviz_improvement_backlog.md†L5-L20】
- Linked the user guide and workspace docs to the new matrix while surfacing jdaviz attribution notes across ingestion, viewer, and differential workflows. 【F:docs/app/user_guide.md†L1-L15】【F:docs/app/archive_and_provenance.md†L1-L13】【F:docs/app/overlay_workspace.md†L1-L13】【F:docs/app/differential_workspace.md†L1-L13】
- Updated version metadata, patch notes, and the patch log so release collateral records the documentation credit work. 【F:app/version.json†L1-L5】【F:docs/patch_notes/v1.2.1k.md†L1-L18】【F:PATCHLOG.txt†L33-L35】

## Verification
- Not applicable (documentation-only change).

## Docs Consulted
- `docs/mirrored/stsci_archive/data_format.md` — reviewed FITS documentation formatting to keep external references consistent. 【F:docs/mirrored/stsci_archive/data_format.md†L1-L18】【F:docs/mirrored/stsci_archive/data_format.meta.json†L1-L7】
