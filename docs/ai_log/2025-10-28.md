# AI Log — 2025-10-28

## Tasking — Keep absorbance and transmittance on native scales
- Added `_flux_axis_category` detection and dual-axis routing in `_build_overlay_figure` so absorbance overlays use a dedicated y-axis while transmittance and other flux traces remain on the primary scale. 【F:app/ui/main.py†L2116-L2437】
- Updated `_add_line_trace` to honor Plotly's secondary axes, ensuring hover markers follow the same absorbance/transmittance split. 【F:app/ui/main.py†L2189-L2235】
- Bumped release metadata and patch notes to advertise the new dual-axis plotting. 【F:app/version.json†L1-L4】【F:docs/patch_notes/v1.2.1z.md†L1-L6】

## Verification
- `python -m compileall app/ui/main.py` 【7deb01†L1-L2】

## Docs Consulted
- `docs/runtime.json` 【F:docs/runtime.json†L1-L21】

## Tasking — Align patch log with raw-axis release metadata
- Added the v1.2.1aa patch entry so `get_version_info()` surfaces the raw-unit preservation summary in the UI header. 【F:PATCHLOG.txt†L52-L52】
- Updated the docs tab regression to expect the new patch metadata. 【F:tests/ui/test_docs_tab.py†L90-L107】

## Verification
- _Not run (doc/test updates only)_

## Docs Consulted
- `docs/runtime.json` 【F:docs/runtime.json†L1-L21】

## Tasking — Preserve Quant IR raw axes
- Removed the synthetic cm⁻¹ arrays and left Quant IR payloads with the native wavelength samples while keeping metadata/provenance unit hints in sync with the reported axis. 【F:app/server/fetchers/nist_quant_ir.py†L1-L220】【F:app/server/fetchers/nist_quant_ir.py†L220-L360】
- Updated release metadata and authored new patch notes announcing the raw-unit preservation fix. 【F:app/version.json†L1-L5】【F:docs/patch_notes/v1.2.1aa.md†L1-L5】

## Verification
- `python -m compileall -f app/server/fetchers/nist_quant_ir.py` 【270195†L1-L2】

## Docs Consulted
- `docs/runtime.json` 【F:docs/runtime.json†L1-L21】

## Tasking — Normalize IR JCAMP units and add health check
- Routed JCAMP ingestion through the IRMeta/to_A10 pipeline, logged FIRSTY verification, and stored IR sanity diagnostics plus conversion provenance for coefficients that still need path length and mole fraction inputs.【F:app/server/ingest_jcamp.py†L357-L571】【F:app/server/ir_units.py†L7-L60】
- Added Streamlit prompts to capture coefficient parameters, convert overlays in-session, expose IR sanity expanders, and shift overlay plots to scientific tick/hover formatting with cm⁻¹ inversion only when metadata demands it.【F:app/ui/main.py†L279-L467】【F:app/ui/main.py†L2452-L2687】
- Updated export manifests, docs, and release collateral with IR diagnostics and rolled a ?health=1 endpoint plus first-load routing guard for uptime probes.【F:app/export_manifest.py†L23-L62】【F:docs/app/ir_import_units.md†L1-L5】【F:app/ui/main.py†L66-L72】【F:app/app_patched.py†L1-L48】

## Verification
- `pytest` 【bce53d†L1-L45】

## Docs Consulted
- `docs/runtime.json` 【F:docs/runtime.json†L1-L21】

## Tasking — Stabilise IR hotfix regressions
- Normalised Quant IR finalisation to default cm⁻¹ metadata, emit wavenumber arrays, and retain continuity links in the plaintext patch notes.【F:app/server/fetchers/nist_quant_ir.py†L324-L365】【F:docs/PATCH_NOTES/v1.2.1aa.txt†L1-L3】
- Added overlay extras plumbing and broadened target panel grouping expectations so regression tests cover the updated output without losing grouped collections.【F:app/ui/main.py†L1305-L1534】【F:tests/ui/test_targets_panel_layout.py†L41-L59】
- Published v1.2.1aa brains/index updates and continuity docs for the hotfix release to satisfy the continuity guardrails.【F:docs/brains/brains_v1.2.1aa.md†L1-L11】【F:docs/brains/brains_INDEX.md†L1-L34】

## Verification
- `pytest` 【bce53d†L1-L45】

## Docs Consulted
- `docs/runtime.json` 【F:docs/runtime.json†L1-L21】
