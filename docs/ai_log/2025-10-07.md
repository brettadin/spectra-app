# AI Log — 2025-10-07

## Tasking — v1.2.0k
- Reorder the target catalog UI so discovery controls, manifest summary, and overlay actions read logically.
- Add layout-focused AppTest coverage that locks the new structure to the Spectra App v1.2 contract.
- Refresh brains, patch notes, patch log, AI handoff, and version metadata per continuity rules.

## Actions & Decisions
- Reviewed the v1.2+ handoff blueprint to confirm continuity artefact requirements before modifying the catalog UI. 【F:docs/ai_handoff/Spectra App v1.2+ – Handoff Protocol & Task Blueprint.txt†L1-L78】
- Consulted the MAST API reference to validate available manifest fields when deriving collection/group labels. 【F:docs/mirrored/mast_api.meta.json†L1-L6】
- Replaced the legacy catalog expander body with search/filters, manifest metrics, and grouped product actions so users select before scrolling the table. 【F:app/ui/targets.py†L86-L204】
- Added Streamlit snapshot coverage to assert the presence of search inputs, manifest metrics, and collection filters in the redesigned panel. 【F:tests/ui/test_targets_panel_layout.py†L1-L57】
- Rolled continuity collateral (version, brains, patch notes md/txt, patch log, brains index, AI handoff prompt) for v1.2.0k. 【F:app/version.json†L1-L5】【F:docs/brains/brains_v1.2.0k.md†L1-L23】【F:docs/patch_notes/v1.2.0k.md†L1-L27】【F:docs/PATCH_NOTES/v1.2.0k.txt†L1-L3】【F:PATCHLOG.txt†L1-L27】【F:docs/brains/brains_INDEX.md†L1-L62】【F:docs/ai_handoff/AI_HANDOFF_PROMPT_v1.2.0k.md†L1-L32】

## Verification
- `pytest tests/ui/test_targets_panel_layout.py` 【7480be†L1-L6】

## Outstanding Follow-ups
- Extend AppTests to cover manifests without curated MAST datasets so the summary container handles the empty-path gracefully.
- Restore the docs search/RAG tooling highlighted in prior handoff prompts (faiss + sentence-transformers) to satisfy AGENTS.md.

## Docs Consulted
- Spectra App v1.2+ – Handoff Protocol & Task Blueprint. 【F:docs/ai_handoff/Spectra App v1.2+ – Handoff Protocol & Task Blueprint.txt†L1-L78】
- MAST API Documentation (field catalog). 【F:docs/mirrored/mast_api.meta.json†L1-L6】

## Tasking — v1.2.1r
- Restore the Quant IR sidebar by providing a supported hook for manual WebBook species when the private helper is absent.
- Keep manual provenance messaging intact while tolerating fetcher implementations that pre-date the helper rename.
- Refresh release collateral and unit coverage in line with the v1.2 continuity contract.

## Actions & Decisions
- Added a public `manual_species_catalog()` export that mirrors the curated WebBook entries while keeping `_manual_species_catalog()` as a compatibility alias. 【F:app/server/fetchers/nist_quant_ir.py†L18-L135】
- Updated the Quant IR sidebar form to call whichever helper exists and defensively swallow catalog lookup failures so the panel renders even on legacy deployments. 【F:app/ui/main.py†L1557-L1591】
- Swapped the regression onto the public helper and rolled release metadata/notes to capture the change. 【F:tests/server/test_nist_quant_ir.py†L96-L109】【F:app/version.json†L1-L5】【F:docs/patch_notes/v1.2.1r.md†L1-L10】

## Verification
- `pytest tests/server/test_nist_quant_ir.py -q` 【b20783†L1-L2】

## Docs Consulted — v1.2.1r
- _None._

## Tasking — v1.2.1s
- Resolve the Quant IR sidebar crash caused by accessing the legacy `_manual_species_catalog` attribute on deployments that never exposed it.
- Maintain manual WebBook provenance messaging for curated molecules while tolerating older fetcher modules.
- Roll release collateral in line with the v1.2 continuity rules.

## Actions & Decisions
- Wrapped the Quant IR manual catalog getter lookup in an AttributeError guard so the sidebar uses the public helper when the legacy alias is absent. 【F:app/ui/main.py†L1583-L1597】
- Incremented the release metadata and documented the compatibility patch in brains and patch notes. 【F:app/version.json†L1-L5】【F:docs/atlas/brains.md†L1-L18】【F:docs/patch_notes/v1.2.1s.md†L1-L9】

## Verification
- `pytest tests/server/test_nist_quant_ir.py -q` 【b20783†L1-L2】

## Docs Consulted — v1.2.1s
- _None._

## Tasking — v1.2.1t
- Reorient Quant IR absorption spectra so catalog molecules plot as downward features like the manual WebBook presets.
- Preserve manual transmission traces while annotating absorption payload metadata/provenance for downstream consumers.
- Refresh versioning collateral so the app header and docs advertise the new patch.

## Actions & Decisions
- Introduced a flux orientation helper that flips Quant IR catalog spectra, updates downsample tiers, and stamps absorption axis metadata/provenance while leaving manual transmission payloads intact. 【F:app/server/fetchers/nist_quant_ir.py†L310-L371】【F:app/server/fetchers/nist_quant_ir.py†L373-L452】
- Expanded unit coverage to assert non-manual payloads invert while manual spectra remain untouched, then rolled version metadata, patch notes, and patch log for v1.2.1t. 【F:tests/server/test_nist_quant_ir.py†L110-L151】【F:app/version.json†L1-L5】【F:docs/patch_notes/v1.2.1t.md†L1-L9】【F:PATCHLOG.txt†L40-L42】

## Verification
- `pytest tests/server/test_nist_quant_ir.py -q`

## Docs Consulted — v1.2.1t
- _None._

## Tasking — v1.2.1u
- Convert Quant IR absorbance payloads into transmission curves so catalog overlays mirror the manual WebBook baselines.
- Align Quant IR metadata/provenance units with the new transmission orientation while preserving manual WebBook spectra.
- Update release collateral and regression coverage per the v1.2 continuity contract.

## Actions & Decisions
- Attempted to launch the local docs search server but `faiss` is unavailable in the runner, so deferred to existing docs context. 【a6618d†L1-L6】
- Replaced the Quant IR flux inversion with a Beer–Lambert transmission conversion (T = 10^(-absorbance)), clamped negative absorbance noise, propagated the new units into downsample tiers, and refreshed axis/flux metadata. 【F:app/server/fetchers/nist_quant_ir.py†L303-L385】
- Extended the Quant IR orientation tests to assert the transmission conversion, manual WebBook preservation, and provenance metadata while updating version metadata, patch notes, and the patch log for v1.2.1u. 【F:tests/server/test_nist_quant_ir.py†L110-L170】【F:app/version.json†L1-L5】【F:docs/patch_notes/v1.2.1u.md†L1-L11】【F:PATCHLOG.txt†L42-L43】

## Verification
- `pytest tests/server/test_nist_quant_ir.py -q`

## Docs Consulted — v1.2.1u
- _None._

## Tasking — v1.2.1v
- Align Quant IR overlay wavenumber plots with laboratory convention so high wavenumbers appear on the left.
- Ensure explicit viewport ranges respect the reversed wavenumber axis without disturbing other unit views.
- Refresh release collateral and regression coverage to document the UI orientation fix.

## Actions & Decisions
- Reversed the Plotly x-axis whenever the workspace display units resolve to `cm⁻¹`, carrying the reversal through explicit viewport ranges so manual and catalog traces both mirror standard IR orientation. 【F:app/ui/main.py†L2296-L2326】
- Added a regression that converts a synthetic spectrum to wavenumber units and asserts the axis reversal plus descending samples, preventing future orientation regressions. 【F:tests/ui/test_overlay_mixed_axes.py†L22-L46】
- Bumped the release metadata, patch log, and notes to v1.2.1v while chronicling the change in the brains index. 【F:app/version.json†L1-L5】【F:PATCHLOG.txt†L44-L48】【F:docs/patch_notes/v1.2.1v.md†L1-L9】【F:docs/atlas/brains.md†L173-L180】

## Verification
- `pytest tests/ui/test_overlay_mixed_axes.py -q` 【62a075†L1-L2】

## Docs Consulted — v1.2.1v
- _None._
