# AI Log — 2025-10-02

## Tasking — v1.2.0d
- Replace the hard-coded Docs tab banner with the active patch metadata.
- Add regression coverage to prevent the banner from drifting away from `_resolve_patch_metadata` output.
- Roll continuity artefacts (brains, patch notes, AI handoff, patch log, version bump) for the v1.2.0d hotfix.

## Actions & Decisions
- Reviewed the v1.2+ handoff blueprint to confirm the continuity checklist before modifying UI code. 【F:docs/ai_handoff/Spectra App v1.2+ – Handoff Protocol & Task Blueprint.txt†L1-L120】
- Wired `_render_docs_tab` to accept `version_info` and render the `patch_raw` line resolved from `_resolve_patch_metadata`, falling back to the summary/placeholder when absent. 【F:app/ui/main.py†L2544-L2559】
- Added `tests/ui/test_docs_tab.py` to stub Streamlit widgets, inject a temporary docs library, and assert the banner equals the provided patch metadata. 【F:tests/ui/test_docs_tab.py†L1-L55】
- Bumped `app/version.json` to v1.2.0d and refreshed patch notes (md/txt), brains, handoff prompt, patch log, and AI log per continuity rules. 【F:app/version.json†L1-L5】【F:PATCHLOG.txt†L17-L19】【F:docs/patch_notes/v1.2.0d.md†L1-L20】【F:docs/PATCH_NOTES/v1.2.0d.txt†L1-L1】【F:docs/brains/brains_v1.2.0d.md†L1-L18】【F:docs/ai_handoff/AI_HANDOFF_PROMPT_v1.2.0d.md†L1-L21】【F:docs/brains/brains_INDEX.md†L1-L33】
- Noted that `faiss` is still unavailable, preventing the required docs search server from running; flagged this gap in the handoff prompt. 【6ba616†L1-L4】
- Consulted Astropy's VOTable provenance guidelines for continuity context while updating the Docs tab documentation links. 【F:docs/mirrored/astropy/io/votable.meta.json†L1-L6】

## Verification
- `pytest tests/ui/test_docs_tab.py` 【cf1b1b†L1-L5】

## Outstanding Follow-ups
- Restore the FAISS-backed documentation search stack so AGENTS.md requirements can be satisfied instead of reported as blocked.
- Extend Docs tab tests into broader Streamlit snapshots once the documentation set expands.
- Continue the v1.2 ingestion/provenance backlog (SIMBAD resolver, archive fetch workflow, export manifest enrichment).

## Docs Consulted
- Spectra App v1.2+ – Handoff Protocol & Task Blueprint (internal).
- https://docs.astropy.org/en/latest/io/votable/

## Tasking — v1.2.1e
- Replace the CALSPEC sample shim with an astroquery-backed downloader that records real provenance for curated spectra.
- Prune the sample registry so the library UI references only vetted CALSPEC targets.
- Refresh regression coverage and continuity collateral (patch note, brains entry, AI log, version metadata).

## Actions & Decisions
- Swapped the CALSPEC downloader to `astroquery.mast.Observations.download_file`, tagging provenance with the download agent and cache location. 【F:app/server/fetchers/mast.py†L1-L210】
- Introduced `materialise_curated_mast_library` and updated the helper script so curation scripts emit a manifest per fetched CALSPEC target. 【F:app/server/fetch_archives.py†L1-L74】【F:scripts/fetch_samples.py†L1-L15】
- Rebuilt `data_registry`/`catalog.csv` around the nine curated CALSPEC standards to align UI metrics with the vetted library. 【F:data_registry/catalog.csv†L1-L10】【F:data_registry/Feige_110/manifest.json†L1-L44】
- Added server-side regression coverage that exercises the astroquery-backed fetcher and curated materialiser end-to-end. 【F:tests/server/test_fetch_mast.py†L1-L120】【F:tests/server/test_fetch_archives.py†L1-L50】
- Reindexed release collateral for v1.2.1e (version metadata, brains entry, patch notes). 【F:app/version.json†L1-L5】【F:docs/atlas/brains.md†L111-L114】【F:docs/patch_notes/v1.2.1e.md†L1-L40】

## Verification
- `pytest tests/server/test_fetch_mast.py tests/server/test_fetch_archives.py -q` 【bfbe40†L1-L9】

## Docs Consulted
- https://astroquery.readthedocs.io/en/latest/mast/mast_obsquery.html 【F:docs/mirrored/astroquery/mast/mast_obsquery.meta.json†L1-L7】

## Tasking — v1.2.0f
- Resolve the Streamlit rerun warning emitted by the example browser provider selector.
- Preserve cached provider filters and update regression coverage accordingly.
- Roll continuity artefacts (version, brains, patch notes, AI log, patch log) for the v1.2.0f hotfix.

## Actions & Decisions
- Reviewed the v1.2+ handoff protocol to reconfirm the continuity checklist before touching the example browser UI. 【F:docs/ai_handoff/Spectra App v1.2+ – Handoff Protocol & Task Blueprint.txt†L1-L120】
- Consulted the MAST API reference to confirm provider naming conventions while validating fallback behaviour. 【F:docs/mirrored/mast_api.meta.json†L1-L7】
- Added `_normalise_provider_defaults` and refactored `render_example_browser_sheet` to seed widget defaults without mutating Streamlit-managed keys post-render. 【F:app/ui/example_browser.py†L91-L189】
- Extended `tests/ui/test_example_browser.py` with helper-focused unit tests covering stale provider removal and default fallbacks. 【F:tests/ui/test_example_browser.py†L31-L67】
- Bumped `app/version.json` to v1.2.0f and refreshed patch notes (md/txt), brains index/log, and patch log per the v1.2 continuity contract. 【F:app/version.json†L1-L5】【F:docs/patch_notes/v1.2.0f.md†L1-L19】【F:docs/PATCH_NOTES/v1.2.0f.txt†L1-L3】【F:docs/brains/brains_v1.2.0f.md†L1-L18】【F:docs/brains/brains_INDEX.md†L1-L24】【F:PATCHLOG.txt†L1-L21】

## Verification
- `pytest tests/ui/test_example_browser.py` 【eb5f05†L1-L5】

## Outstanding Follow-ups
- Expand UI snapshot coverage once Streamlit tooling allows us to assert widget warning-free reruns end-to-end.
- Audit the duplicated v1.2.0d rows in the brains index during the next documentation cleanup.

## Docs Consulted
- Spectra App v1.2+ – Handoff Protocol & Task Blueprint (internal).
- https://mast.stsci.edu/api/v0//

## Tasking — v1.2.0e
- Keep the Spectra App header caption aligned with the live patch metadata.
- Add regression coverage so the header continues to prioritise the patch version.
- Refresh continuity collateral (version, patch notes, brains, AI handoff/log) for v1.2.0e.

## Actions & Decisions
- Re-read the v1.2+ handoff protocol to confirm the continuity checklist and regression expectations before adjusting the header. 【F:docs/ai_handoff/Spectra App v1.2+ – Handoff Protocol & Task Blueprint.txt†L1-L120】
- Introduced `_render_app_header` and updated `render()` to call it so the header caption reuses `_resolve_patch_metadata`, preferring the resolved patch version and timestamp. 【F:app/ui/main.py†L2538-L2576】
- Extended `tests/ui/test_docs_tab.py` with a header-specific regression asserting the caption starts with the patch version and includes the timestamp + summary. 【F:tests/ui/test_docs_tab.py†L57-L83】
- Bumped `app/version.json` to v1.2.0e and refreshed patch notes (md/txt), brains log/index, AI handoff brief, and patch log per the continuity contract. 【F:app/version.json†L1-L5】【F:PATCHLOG.txt†L17-L20】【F:docs/patch_notes/v1.2.0e.md†L1-L18】【F:docs/PATCH_NOTES/v1.2.0e.txt†L1-L1】【F:docs/brains/brains_v1.2.0e.md†L1-L17】【F:docs/brains/brains_INDEX.md†L1-L34】【F:docs/ai_handoff/AI_HANDOFF_PROMPT_v1.2.0e.md†L1-L22】
- Re-confirmed Astropy's provenance guidance while validating the continuity updates. 【F:docs/mirrored/astropy/io/votable.meta.json†L1-L6】

## Verification
- `pytest tests/ui/test_docs_tab.py` 【cf1b1b†L1-L5】

## Outstanding Follow-ups
- Restore the FAISS-backed documentation search stack so AGENTS.md requirements move from blocked to satisfied.
- Expand Streamlit snapshot tests to cover the full `render()` pipeline, exercising `_render_app_header` end-to-end.
- Continue v1.2 backlog items (SIMBAD resolver, ingestion queue refactors, provenance/export enrichment).

## Docs Consulted
- Spectra App v1.2+ – Handoff Protocol & Task Blueprint (internal).
- https://docs.astropy.org/en/latest/io/votable/
