# AI Log — 2025-10-11

## Tasking — v1.2.0p
- Remove the warning banner in the example browser by deferring the provider multiselect default to first-run only.
- Confirm provider selections persist across reruns and roll continuity collateral per the v1.2+ protocol.

## Actions & Decisions
- Refactored the example browser provider multiselect to skip the `default` argument once Streamlit has stored a selection, normalising cached values in session state so stale providers are pruned without discarding user intent. 【F:app/ui/example_browser.py†L185-L214】
- Added an AppTest regression that reruns the browser entrypoint with narrowed and stale provider selections to ensure persistence without surfacing `st.warning` banners. 【F:tests/ui/test_example_browser.py†L30-L128】
- Recorded the behaviour change in brains, version metadata, and patch notes for v1.2.0p. 【F:docs/atlas/brains.md†L21-L23】【F:app/version.json†L1-L5】【F:docs/patch_notes/v1.2.0p.md†L1-L18】

## Verification
- `pytest tests/ui/test_example_browser.py::test_provider_filter_persists_session_state` 【33ba02†L1-L4】

## Docs Consulted
- None (RAG query returned no relevant hits for "example browser" or provider persistence).

## Tasking — v1.2.0q
- Decouple overlay ingestion from the render loop so queued downloads run in the background while exposing live status in the sidebar.
- Prove the async worker keeps the queue responsive across reruns even when downloads stall.

## Actions & Decisions
- Replaced the synchronous queue walker with a session-scoped executor, progress callbacks, and job snapshots so reruns simply schedule work and reconcile finished futures. 【F:app/ui/main.py†L526-L792】
- Added an “Overlay downloads” sidebar section that renders status captions and success/error callouts for each job using the new snapshot helper. 【F:app/ui/main.py†L795-L839】【F:app/ui/main.py†L3426-L3451】
- Captured a slow-download regression AppTest to assert the queue stays interactive and surfaces completion banners once the worker finishes. 【F:tests/ui/test_overlay_ingest_queue_async.py†L12-L112】
- Logged the architecture shift in patch notes and brains while bumping version metadata to v1.2.0q. 【F:docs/patch_notes/v1.2.0q.md†L1-L18】【F:docs/atlas/brains.md†L31-L36】【F:app/version.json†L1-L5】

## Verification
- `pytest tests/ui/test_overlay_ingest_queue_async.py::test_ingest_queue_remains_interactive_during_long_download` 【437e22†L1-L3】

## Docs Consulted
- `STATE_KEYS_REFERENCE` to confirm expectations around new `st.session_state` mutations. 【F:docs/atlas/STATE_KEYS_REFERENCE.md†L1-L15】

## Tasking — v1.2.0r
- Harden FITS ingestion so byte-string axis unit hints decode before wavelength/time classification.
- Extend regression coverage and roll the v1.2 continuity collateral.

## Actions & Decisions — v1.2.0r
- Added `_decode_header_text` and routed `_parse_time_unit_hint`, `_normalise_wavelength_unit`, and `_unit_is_wavelength` through it so decoded header bytes are case-folded before alias resolution. 【F:app/server/ingest_fits.py†L233-L305】【F:app/server/ingest_fits.py†L338-L353】【F:app/server/ingest_fits.py†L751-L815】
- Captured regression fixtures that inject byte-string `Angstroms` and `BJD - 2457000, days` table headers, asserting ingestion preserves the correct `axis_kind`. 【F:tests/server/test_ingest_fits.py†L86-L135】【F:tests/server/test_ingest_fits.py†L396-L426】
- Published the continuity updates (version bump, patch notes, brains) documenting the hotfix. 【F:app/version.json†L1-L5】【F:docs/patch_notes/v1.2.0r.md†L1-L18】【F:docs/atlas/brains.md†L24-L29】

## Verification — v1.2.0r
- `pytest tests/server/test_ingest_fits.py` 【dacbb4†L1-L28】

## Docs Consulted — v1.2.0r
- Astropy units reference for header byte handling expectations. 【F:docs/mirrored/astropy/units.meta.json†L1-L6】
