# AI Log — 2025-10-11

## Tasking — v1.2.0p
- Remove the warning banner in the example browser by deferring the provider multiselect default to first-run only.
- Confirm provider selections persist across reruns and roll continuity collateral per the v1.2+ protocol.

## Actions & Decisions
- Refactored the example browser provider multiselect to skip the `default` argument once Streamlit has stored a selection, normalising cached values in session state so stale providers are pruned without discarding user intent. 【F:app/ui/example_browser.py†L185-L214】
- Added an AppTest regression that reruns the browser entrypoint with narrowed and stale provider selections to ensure persistence without surfacing `st.warning` banners. 【F:tests/ui/test_example_browser.py†L30-L128】
- Recorded the behaviour change in brains, version metadata, and patch notes for v1.2.0p. 【F:docs/atlas/brains.md†L21-L23】【F:app/version.json†L1-L5】【F:docs/patch_notes/v1.2.0p.md†L1-L18】

## Verification
- `pytest tests/ui/test_example_browser.py::test_provider_filter_persists_session_state` 【33ba02†L1-L4】

## Docs Consulted
- None (RAG query returned no relevant hits for "example browser" or provider persistence).

## Tasking — v1.2.0q
- Decouple overlay ingestion from the render loop so queued downloads run in the background while exposing live status in the sidebar.
- Prove the async worker keeps the queue responsive across reruns even when downloads stall.

## Actions & Decisions
- Replaced the synchronous queue walker with a session-scoped executor, progress callbacks, and job snapshots so reruns simply schedule work and reconcile finished futures. 【F:app/ui/main.py†L526-L792】
- Added an “Overlay downloads” sidebar section that renders status captions and success/error callouts for each job using the new snapshot helper. 【F:app/ui/main.py†L795-L839】【F:app/ui/main.py†L3426-L3451】
- Captured a slow-download regression AppTest to assert the queue stays interactive and surfaces completion banners once the worker finishes. 【F:tests/ui/test_overlay_ingest_queue_async.py†L12-L112】
- Logged the architecture shift in patch notes and brains while bumping version metadata to v1.2.0q. 【F:docs/patch_notes/v1.2.0q.md†L1-L18】【F:docs/atlas/brains.md†L31-L36】【F:app/version.json†L1-L5】

## Verification
- `pytest tests/ui/test_overlay_ingest_queue_async.py::test_ingest_queue_remains_interactive_during_long_download` 【437e22†L1-L3】

## Docs Consulted
- `STATE_KEYS_REFERENCE` to confirm expectations around new `st.session_state` mutations. 【F:docs/atlas/STATE_KEYS_REFERENCE.md†L1-L15】

## Tasking — v1.2.0r
- Consolidate differential and similarity controls into the workspace tab and refresh collateral per the v1.2+ contract.

## Actions & Decisions
- Rebuilt the differential tab to own normalization, differential mode, and explanatory copy so comparisons stay contextually grouped with their compute form. 【F:app/ui/main.py†L3088-L3131】【F:app/ui/main.py†L3285-L3288】
- Embedded the similarity metric, weighting, and normalization widgets inside a tab expander and pruned the sidebar group to keep session settings lean. 【F:app/ui/main.py†L3132-L3192】【F:app/ui/main.py†L1492-L1509】
- Captured AppTest regressions confirming the controls moved from the sidebar into the tab and remain available for similarity runs. 【F:tests/ui/test_sidebar_display_controls.py†L1-L33】【F:tests/ui/test_differential_form.py†L1-L109】
- Logged the change set across version metadata, patch notes, and brains for continuity. 【F:app/version.json†L1-L5】【F:docs/patch_notes/v1.2.0r.md†L1-L18】【F:docs/atlas/brains.md†L30-L33】

## Verification
- `pytest tests/ui/test_sidebar_display_controls.py tests/ui/test_differential_form.py` 【260840†L1-L5】

## Docs Consulted
- None (local RAG search for "differential controls" not required; existing UI contract already covered the constraints).
