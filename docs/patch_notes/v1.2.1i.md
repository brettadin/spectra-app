# Patch Notes — v1.2.1i

## Summary
- Normalised local uploads to emit `Spectrum1D` payloads while validating wavelength/flux units so ingestion failures surface actionable messages.
- Added regression coverage proving both primary and additional traces receive `Spectrum1D` objects and that unknown flux units raise helpful errors.

## Details
1. **Spectrum1D normalisation for local ingest**
   - Convert parsed wavelengths/flux into Astropy quantities and build `Spectrum1D` containers for base and auxiliary traces, propagating coercion failures as `LocalIngestError`s. 【F:app/utils/local_ingest.py†L1-L386】【F:app/utils/local_ingest.py†L597-L772】
   - Skip Spectrum1D construction for image payloads while leaving provenance untouched so non-spectral products still load. 【F:app/utils/local_ingest.py†L323-L362】【F:app/utils/local_ingest.py†L712-L744】
2. **Specutils dependency and regression coverage**
   - Declared `specutils` as an application dependency to support Spectrum1D construction. 【F:requirements.txt†L1-L11】
   - Extended ingestion tests to assert Spectrum1D objects on uploads, validate flux unit coercion, and cover additional trace payloads. 【F:tests/server/test_local_ingest.py†L1-L186】【F:tests/server/test_local_ingest.py†L230-L321】

## Verification
- `pytest tests/server/test_local_ingest.py`
# Spectra App v1.2.1i — Panel registry foundation

## Summary
- Added a plugin-style panel registry module so sidebar and workspace components register identifiers, labels, and render callbacks before layout. 【F:app/ui/panel_registry.py†L1-L112】
- Wrapped existing overlay, differential, library, docs, and control panels in registry-aware adapters to guard against duplicate registration when modules reload. 【F:app/ui/main.py†L3414-L3498】
- Rebuilt the main render loop to assemble sidebar containers and tabs from registered panel specs, enabling dynamic layouts. 【F:app/ui/main.py†L3518-L3543】

## Verification
- `python -m compileall app/ui/panel_registry.py app/ui/main.py`
