# Patch Notes — v1.2.0x

## Summary
- Finalize overlay ingestion on the main thread to eliminate Streamlit ScriptRunContext warnings while preserving async progress updates. 【F:app/ui/main.py†L621-L678】【F:app/ui/main.py†L680-L713】

## Details
1. **Thread-safe overlay completion**
   - Return overlay payloads from worker futures and finalize additions on the main thread so Streamlit state mutations stay in the UI thread. 【F:app/ui/main.py†L621-L678】
   - Guard ingest job updates behind thread-safe records and reuse `_add_overlay_payload` only after the background job resolves. 【F:app/ui/main.py†L680-L713】
2. **Regression coverage**
   - Extend the ingest queue AppTest suite with a warning assertion to prove queued overlays complete without ScriptRunContext noise. 【F:tests/ui/test_overlay_ingest_queue_async.py†L9-L128】

## Verification
- `pytest tests/ui/test_overlay_ingest_queue_async.py` 【5b7b2a†L1-L3】

## Continuity
- Added the v1.2.0x entry to `PATCHLOG.txt` so `_resolve_patch_metadata()` surfaces the main-thread ingest summary across the app header and Docs tab. 【F:PATCHLOG.txt†L27-L27】【F:tests/ui/test_docs_tab.py†L16-L102】【F:app/_version.py†L32-L67】
- Version bumped to v1.2.0x with brains and AI log updates recorded. 【F:app/version.json†L1-L5】【F:docs/atlas/brains.md†L1-L8】【F:docs/ai_log/2025-10-14.md†L1-L16】
