# Patch Notes — v1.2.1e

## Summary
- Replace the CALSPEC downloader with an astroquery-powered pipeline that caches curated spectra and records download provenance. 【F:app/server/fetchers/mast.py†L1-L210】
- Introduce a curated-library materialiser for scripts so each vetted CALSPEC target writes out provenance-rich metadata. 【F:app/server/fetch_archives.py†L1-L74】【F:scripts/fetch_samples.py†L1-L15】
- Prune the registry to the vetted CALSPEC stars and update catalog metadata to highlight the curated spectra. 【F:data_registry/catalog.csv†L1-L10】【F:data_registry/Sirius_A/manifest.json†L1-L45】

## Details
1. **Astroquery-backed downloads**
   - Route CALSPEC product transfers through `astroquery.mast.Observations.download_file`, preserving cache hits and tagging the resulting provenance with the astroquery download agent. 【F:app/server/fetchers/mast.py†L142-L209】
   - Harden index parsing and filename selection so the curated target roster continues to resolve the latest CALSPEC releases. 【F:app/server/fetchers/mast.py†L212-L308】
2. **Curated manifest generation**
   - Added `materialise_curated_mast_library` to iterate the curated CALSPEC roster, invoking `mast.fetch` for each star and persisting wavelength counts plus provenance. 【F:app/server/fetch_archives.py†L31-L74】
   - Updated the helper script to call the new materialiser and emit the curated manifest location for downstream tooling. 【F:scripts/fetch_samples.py†L1-L15】
   - Locked regression coverage that exercises both the astroquery-backed fetcher and the curated materialiser end-to-end. 【F:tests/server/test_fetch_mast.py†L1-L120】【F:tests/server/test_fetch_archives.py†L1-L50】
3. **Registry refresh**
   - Replaced the legacy registry entries with nine curated CALSPEC manifests and refreshed `catalog.csv` so UI metrics report only vetted spectra. 【F:data_registry/catalog.csv†L1-L10】【F:data_registry/Vega/manifest.json†L1-L44】
   - Added manifest stubs for the newly curated BD+17 4708 and Feige 110 standards. 【F:data_registry/BD+17_4708/manifest.json†L1-L44】【F:data_registry/Feige_110/manifest.json†L1-L44】

## Verification
- `pytest tests/server/test_fetch_mast.py tests/server/test_fetch_archives.py -q` 【bfbe40†L1-L9】

## Continuity
- Bumped release metadata to v1.2.1e and documented the update in the brains log and AI activity record. 【F:app/version.json†L1-L5】【F:docs/atlas/brains.md†L111-L114】【F:docs/ai_log/2025-10-02.md†L28-L44】
