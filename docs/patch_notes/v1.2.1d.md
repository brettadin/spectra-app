# Patch Notes — v1.2.1d

## Summary
- Move `OverlayIngestResult` into a shared ingest module so background futures return a stable type across reruns and the UI keeps consuming payloads successfully. 【F:app/ingest/results.py†L1-L18】【F:app/ui/main.py†L671-L798】
- Add regression coverage that simulates a rerun before the future resolves and confirms `_add_overlay_payload` handles the payload without triggering the "Unexpected ingest result" fallback. 【F:tests/ui/test_overlay_ingest_queue_async.py†L186-L289】
- Refresh release collateral with the new version metadata, brains entry, and AI log for the hotfix. 【F:app/version.json†L1-L5】【F:docs/atlas/brains.md†L1-L24】【F:docs/ai_log/2025-10-21.md†L1-L15】

## Details
1. **Shared ingest results**
   - Centralised `OverlayIngestResult` under `app.ingest` and updated the Streamlit worker helpers to import from the shared module, preventing stale class identities from breaking future callbacks after reruns. 【F:app/ingest/results.py†L1-L18】【F:app/ui/main.py†L671-L798】
2. **Regression coverage**
   - Added a unit test that reloads `app.ui.main` before fulfilling a queued future, asserts `_add_overlay_payload` runs, and ensures job details avoid the "Unexpected ingest result" fallback. 【F:tests/ui/test_overlay_ingest_queue_async.py†L186-L289】

## Verification
- `pytest tests/ui/test_overlay_ingest_queue_async.py -q` 【795bdd†L1-L1】【7ae437†L1-L2】

## Continuity
- Bumped `app/version.json` to v1.2.1d and captured the change in the brains log plus AI activity record. 【F:app/version.json†L1-L5】【F:docs/atlas/brains.md†L1-L24】【F:docs/ai_log/2025-10-21.md†L1-L15】
