# Patch Notes — v1.2.0n

## Summary
- Add first-class ingestion for FITS spatial images, propagate WCS metadata, and surface overlays through a dedicated image viewer with contrast controls.

## Details
1. **FITS ingestion updates**
   - `_ingest_image_hdu` now distinguishes spectral vs. spatial HDUs via WCS axis typing, preserving 2-D image payloads, masks, and WCS headers under `axis_kind="image"`. 【F:app/server/ingest_fits.py†L1120-L1350】
   - Table ingestion recognises wavenumbers regardless of canonical label variants and continues to drop non-positive bins before wavelength conversion. 【F:app/server/ingest_fits.py†L470-L620】
2. **Local ingest & metadata**
   - `ingest_local_file` bypasses spectral sample checks for image payloads, forwards the `image` structure, and builds summaries from pixel shape. 【F:app/utils/local_ingest.py†L433-L517】
3. **UI image viewer**
   - Overlay traces carry optional `image` payloads; image axes skip plotting, while `_render_image_overlay_panels` renders Plotly heatmaps with per-trace intensity clipping sliders and WCS captions. 【F:app/ui/main.py†L60-L206】【F:app/ui/main.py†L1910-L2079】
   - Mixed-axis helpers, metadata summaries, and reference logic treat `axis_kind="image"` as non-plottable while maintaining overlay visibility toggles. 【F:app/ui/main.py†L336-L366】【F:app/ui/main.py†L2482-L2527】
4. **Tests**
   - Added server regression coverage for spatial images and wavenumber filtering plus local ingest acceptance. 【F:tests/server/test_ingest_fits.py†L214-L260】【F:tests/server/test_local_ingest.py†L655-L688】
   - UI tests assert metadata formatting, mixed-axis plotting, and image slider session keys. 【F:tests/ui/test_metadata_summary.py†L201-L253】【F:tests/ui/test_overlay_mixed_axes.py†L1-L52】

## Verification
- `pytest tests/server/test_ingest_fits.py tests/server/test_local_ingest.py` 【f66e47†L1-L33】
- `pytest tests/ui/test_metadata_summary.py tests/ui/test_overlay_mixed_axes.py tests/ui/test_overlay_additional_traces.py` 【bd7771†L1-L18】

## Continuity
- Version bumped to v1.2.0n with atlas brain entry, UI contract update, patch notes, and AI log append recorded.
