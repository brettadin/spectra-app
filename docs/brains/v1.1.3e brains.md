# Spectra App — Brains Log (v1.1.3e)
_Last updated: 2025-09-19T23:03:44.507693Z_

## Unit Conversions (Overlay Tab)
- Confirmed working across nm ↔ Å ↔ µm ↔ cm⁻¹ with both small and large datasets (examples: He, Ne, Sun.csv 119 MB).
- Conversion round-trips remain consistent; axis labels and ticks update correctly without distortion.
- Conversion performance is stable, even with high-resolution datasets.
- Issue noted in prior builds (cumulative scaling error) seems fixed: now conversions derive idempotently from canonical nm baseline.

## Duplicate Handling
- Global vs Session vs Off scope toggle confirmed functional.
- "Duplicate skipped" banner shows when ledger blocks an ingest.
- "Ingest anyway" override available and functional.
- Session purge works (banner shows “Session fingerprints purged”).
- Problem: After refreshing app, re-upload of same file is still flagged as duplicate because global ledger persists. Expected behavior: should allow fresh session option unless Global is explicitly selected.

## Overlay Behavior
- No empty legend labels observed.
- Duplicate labels like "Sun (2)" only appear when "Ingest anyway" is pressed, which is correct.
- Traces render cleanly across examples and uploaded files.
- Export still bundles PNG + CSV + manifest with provenance/unit logs.

## Differential Tab
- Subtraction (A−B) and Division (A/B) both functional with resampling and normalization.
- Sun − Ne example produces expected deep absorption-like residuals.
- Sun ÷ He produces enhanced feature spikes but division instability near small denominators remains (spikes ~8 intensity observed).
- Normalization (none/max) toggles correctly.
- Resample slider functional, default ~2200 points.
- A = B case produces trivial zero-line as expected, but multiple traces can clutter dropdown (long names like `He(example)_A−B_He(example)_A−B_Sun…`).
- **Dropdown Issue**: Selecting/changing Trace A or Trace B resets both fields, making workflow clumsy. Needs independent session keys and persistence.
- Legend clutter: derived traces appended without grouping, names too long, duplicates clutter legend.

## Usability Notes
- Dropdown selection UX is the biggest blocker in Differential tab; needs grouping ("Original inputs" vs "Derived traces") and stable selections.
- Legend hygiene still a concern (especially with repeated trivial traces).
- Division guard (epsilon or masking near 0 denominators) still needed.
- Export includes derived traces correctly with lineage in manifest.

## Summary of Lessons
- Unit conversions: ✅ Fixed, stable, round-trip accurate.
- Duplicate guard: ✅ Functional but session vs global separation UX confusing.
- Overlay: ✅ Robust and stable across large datasets.
- Differential: ⚠️ Math works, but UX needs fixes (resetting dropdowns, trace clutter, division spikes).
- Export & provenance: ✅ Solid, includes correct lineage.

## Next Steps
1. Add independent keys for Differential Trace A/B selectors to prevent resets.
2. Group derived traces in dropdowns, with alias naming (Δ1, ÷2, etc.) for clarity.
3. Add division epsilon guard or masking.
4. Suppress trivial zero-line outputs by default (show "A=B suppressed" message instead).
5. Continue logging and updating Brains after each test session.
