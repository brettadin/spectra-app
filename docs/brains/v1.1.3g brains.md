# Spectra App — Brains Log (v1.1.3g)
_Last updated: 2025-09-19T23:28:11.896530Z_

## Purpose of This Entry
This Brains entry is linked to preparing the **next AI handoff prompt**.  
The goal is to ensure continuity across builds, preserve working features, and guide the next AI in making incremental updates without breaking existing functionality.

---

## Current Project State (v1.1.3f → v1.1.3g)
- Overlay and Differential tabs tested extensively.  
- Unit conversions (nm, Å, µm, cm⁻¹) confirmed stable and idempotent.  
- Duplicate guard works with scope controls (Global, Session, Off) + purge and override options.  
- Export system bundles CSV + manifest with provenance and unit logs.  
- Differential math works (A−B, A/B) with normalization and resampling.  
- Issues logged: dropdown reset in Differential tab, cluttered trace list, legend duplication in A=B case, division instability near zero denominators.  
- Brains v1.1.3f documents the rules for how Brains files should be used.  

---

## Next Handoff Goal
The next handoff will cover **data fetching**.  
We will extend the Spectra App to pull in external data (e.g., stellar spectra from archives).  
**Critical rule:** Do not break the current build when adding fetching logic.  
Fetching should be implemented as **modular extensions**, not rewrites.  
The app must continue to run with the Overlay, Differential, and Export tabs intact.

---

## Instructions for AI Handoff Prompts
Every time a new chat or build session starts, the AI must:  
1. **Load and read the Brains file for the last version** (located in `docs/Brains_v<version>.md`).  
2. **Load and read the AI_HANDOFF file** (latest version in `docs/AI_HANDOFF_PROMPT_v<version>.txt`).  
3. Use both as the foundation for continuity before generating code, patch notes, or prompts.  
4. Always respect the patch-only workflow (never overwrite the app wholesale).  
5. Always write UTF-8, structured files (no ellipses, no placeholders).  
6. When adding new features (like data fetching), implement them modularly so core features remain untouched.  

---

## Guidance for Next AI
- Begin by reading `docs/Brains_v1.1.3g.md` (this file) to understand the current state.  
- Then read the latest `AI_HANDOFF_PROMPT` for continuity.  
- Extend the app by implementing **data fetching modules** (using Astroquery, MAST, or other APIs).  
- Add provenance to all fetched data (DOI, URL, instrument, citation).  
- Ensure fetched datasets integrate with overlays without disrupting existing ingestion logic.  
- Update the Brains file to document what worked, what broke, and what was fixed.  
- Update AI_HANDOFF prompt for the next user to continue.  

---

## Summary
Brains v1.1.3g marks the transition from stabilizing Overlay/Differential features to **adding data fetching**.  
The continuity contract requires that Brains and AI_HANDOFF always be read at the start of a new session.  
All changes must be patch-only, non-destructive, and extend functionality without regressions.

