# Patch Notes — v1.2.1

## Summary
- Rehomed overlay trace sampling/vectorisation helpers onto the `OverlayTrace` model so downstream UI components work with the canonical trace type. 【F:app/ui/main.py†L43-L166】
- Hardened overlay regressions with a direct `_build_overlay_figure` instantiation test to guard against missing trace helpers. 【F:tests/ui/test_overlay_mixed_axes.py†L9-L56】

## Details
1. **Trace helper relocation**
   - Moved dataframe conversion, sampling, vectorisation, and point counting logic from `OverlayIngestResult` to `OverlayTrace`, keeping ingest results as status carriers. 【F:app/ui/main.py†L43-L166】【F:app/ui/main.py†L170-L174】
   - Updated metadata summary fixtures to rely on the baked-in helpers while covering downsample payloads. 【F:tests/ui/test_metadata_summary.py†L1-L229】
2. **UI regression coverage**
   - Added a regression that builds an `OverlayTrace` and runs `_build_overlay_figure` to ensure helper methods remain accessible on the trace type. 【F:tests/ui/test_overlay_mixed_axes.py†L22-L56】
   - Simplified overlay test fixtures now that traces supply their own dataframe/vector helpers. 【F:tests/ui/test_overlay_mixed_axes.py†L9-L21】【F:tests/ui/test_metadata_summary.py†L1-L229】

## Verification
- `pytest tests/ui/test_overlay_mixed_axes.py tests/ui/test_metadata_summary.py` 【f6f54f†L1-L13】

## Continuity
- Version bumped to v1.2.1 with brains and AI log updates recorded per the v1.2 protocol. 【F:app/version.json†L1-L5】【F:docs/atlas/brains.md†L1-L12】【F:docs/ai_log/2025-10-17.md†L1-L15】
