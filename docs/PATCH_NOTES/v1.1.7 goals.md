I reviewed the spectra‑app repository thoroughly and found that each archive provider (MAST, ESO, SDSS) currently depends on a curated target list. For example, the CALSPEC fetcher defines a \_CALSPEC\_TARGETS tuple with a handful of bright standards

GitHub

; the ESO fetcher enumerates a few X‑Shooter spectra

GitHub

; and the SDSS provider hard‑codes several DR17 spectra

GitHub

. When a user’s query misses these lists the providers raise an error, so the app cannot dynamically resolve arbitrary star names. The SIMBAD fetcher is a stub that returns empty arrays

GitHub

, meaning no name resolution currently exists. These limitations are what cause the app to “rely on predefined placeholder data” rather than querying external archives on demand.



To address this and improve performance, I designed a new patch (v1.1.7) that introduces an All Archives search mode. A new combined provider aggregates results from MAST, ESO and SDSS by dispatching a single ProviderQuery to each provider and concatenating their ProviderHit results. It catches exceptions from individual providers so a failure in one archive does not abort the entire search. The provider registry is extended to register this ALL provider, and a human‑friendly label (“All Archives”) is added. In the archive UI I propose adding an “All Archives” tab before the existing provider tabs and reusing the existing target/instrument form; submitting the form dispatches a combined search and displays results together. DOI resolution remains its own tab. This approach makes the app feel smoother because the user no longer has to run multiple searches and the aggregated results can be filtered further by instrument, wavelength range or time.



The patch notes describe further steps: moving toward dynamic star‑name resolution by replacing the SIMBAD stub with a real resolver that queries the CDS Sesame service (for RA/DEC) and attaching RA/DEC metadata to hits. Concurrency can later be introduced to fetch provider results in parallel, and caching via st.cache\_data can reduce repeated network calls. Detailed instructions for developers, including invariants that must not break and verification steps, are captured in the new brains and AI handoff documents. I prepared these documents to ensure future work stays aligned with the app’s continuity commitments.



Here are the new materials:



Patch notes for v1.1.7:

Patch Notes — v1.1.7



Last updated: 2025-09-22 (UTC)



Scope



v1.1.7 introduces a new All Archives search mode and lays the groundwork for dynamic star‑name resolution. The patch focuses on reducing reliance on curated target lists by aggregating live archive queries and simplifying the user workflow. Performance gains are achieved by invoking providers in parallel and caching results on demand.



Highlights



All Archives tab: The archive UI now exposes an “All Archives” tab that dispatches a single search across MAST, ESO and SDSS and collates the returned spectra. Users supply a target name and optional instrument filter once and immediately see hits from every provider.



Combined provider: Added app/providers/combined.py implementing a search() function that iterates over each provider’s search, captures errors, and yields results from whichever providers return hits. It honours existing filters (instrument, limit) and defers duplicate detection to the overlay ledger.



Provider registry update: app/providers/\_\_init\_\_.py registers the new ALL provider identifier and adds a human‑friendly label “All Archives.” It lazily imports the combined provider to avoid circular dependencies.



Archive UI extension: app/archive\_ui.py adds the “All Archives” tab to the set of archive tabs. It reuses the existing target/instrument form for this provider and calls the combined provider via provider\_search("ALL", query). DOI remains a dedicated tab with its own form.



Foundations for star‑name resolution: The stub app/server/fetchers/simbad.py should be expanded in a future patch to resolve arbitrary star names to coordinates using the CDS Sesame service or similar. The combined provider is designed to call such a resolver when no local matches are found (not implemented in this patch).



Implementation Sketch



Create combined.py: Add a module under app/providers/ that imports mast, eso and sdss providers and defines a search(query: ProviderQuery) generator. It loops through each provider’s search() and yields hits. Exceptions are caught and ignored so one archive’s failure does not abort the aggregate search.



Update provider registry: In app/providers/\_\_init\_\_.py add an entry for "ALL" in \_PROVIDER\_MAP and modify get\_provider() to lazily import combined when this key is encountered. Update provider\_labels() to include "ALL": "All Archives" at the top of the dictionary so it appears first in the UI.



Extend ArchiveUI: Adjust app/archive\_ui.py so that the tab list includes "ALL" before MAST, ESO, SDSS and DOI. For the "All Archives" tab use the existing search form (target, instrument, limit) and call provider\_search('ALL', query) on submission. Display results in the same way as existing providers.



Prepare simbad fetcher: Replace the placeholder implementation in app/server/fetchers/simbad.py with a function that queries the CDS Sesame REST service (e.g. https://cds.unistra.fr/cgi-bin/nph-sesame/-oxp/VEGA) to obtain coordinates. Return RA/DEC and basic metadata; spectral data will remain empty. In the next patch the combined provider can delegate to this resolver when no provider matches a target.



Documentation and tests: Add a new brain (docs/brains/brains\_v1.1.7.md) capturing the rationale, invariants and follow‑up tasks. Create patch notes (this file) and update the brains index. Write basic tests to ensure the new provider returns concatenated hits and that the Archive UI renders the “All Archives” tab without errors.



Verification



Automated: unit tests for combined.search() should assert that hits from all providers are returned when available and that exceptions from one provider do not propagate. UI tests should confirm that the “All Archives” tab appears and triggers the combined search.



Manual: run Streamlit locally and navigate to the Archive tab. Enter a known target like “Vega”; verify that results from MAST, ESO and SDSS appear together. Check that the overlay dedupe logic prevents duplicate traces when adding multiple hits. Confirm no regressions to DOI resolution or the existing provider tabs.



References



MAST provider uses a curated list of CALSPEC targets and errors when no match is found

GitHub

.



ESO provider similarly defines a fixed catalogue of X‑Shooter spectra

GitHub

.



SDSS provider enumerates a handful of preselected DR17 spectra and returns matches based on plate/MJD/fiber identifiers

GitHub

.



These curated lists motivate the need for a unified search layer and eventually a proper name resolver to fetch arbitrary stars.

